\documentclass[a4paper,titlepage,11pt,twosides,floatssmall]{mwrep}
\usepackage[left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage[OT1]{fontenc}
% \usepackage[utf8]{inputenc}
\usepackage{polski}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
\usepackage{url}
\usepackage{tikz}
\usetikzlibrary{arrows,calc,decorations.markings,math,arrows.meta}
\usepackage{rotating}
\usepackage[percent]{overpic}
\usepackage[cp1250]{inputenc}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{pgfplots}
\usetikzlibrary{pgfplots.groupplots}
\usepackage{listings}
\usepackage{matlab-prettifier}
\usepackage{enumitem,amssymb}
\usepackage{verbatim}							%paczka do komentarza blokowego

\definecolor{szary}{rgb}{0.95,0.95,0.95}
\definecolor{niebieski}{rgb}{0,0.447,0.741}
\definecolor{czerwony}{rgb}{0.85,0.325,0.098}

\usepackage{siunitx}
\sisetup{detect-weight,exponent-product=\cdot,output-decimal-marker={,},per-mode=symbol,binary-units=true,range-phrase={-},range-units=single}
\SendSettingsToPgf

%konfiguracje pakietu listings
\lstset{
	backgroundcolor=\color{szary},
	frame=single,
	breaklines=true,
}
\lstdefinestyle{customlatex}{
	basicstyle=\footnotesize\ttfamily,
	%basicstyle=\small\ttfamily,
}
\lstdefinestyle{customc}{
	breaklines=true,
	frame=tb,
	language=C,
	xleftmargin=0pt,
	showstringspaces=false,
	basicstyle=\small\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{blue},
	stringstyle=\color{orange},
}
\lstdefinestyle{custommatlab}{
	captionpos=t,
	breaklines=true,
	frame=tb,
	xleftmargin=0pt,
	language=matlab,
	showstringspaces=false,
	basicstyle=\footnotesize\ttfamily,
	%basicstyle=\scriptsize\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{blue},
	stringstyle=\color{orange},
}

%wymiar tekstu (bez ¿ywej paginy)
\textwidth 160mm \textheight 247mm

%ustawienia pakietu pgfplots
\pgfplotsset{
tick label style={font=\scriptsize},
label style={font=\small},
legend style={font=\small},
title style={font=\small},
compat=newest										%chyba dobry dodatek, dla subplota xlabel nie nachodzi na inne wykresy
}

\def\figurename{Rys.}
\def\tablename{Tab.}

%konfiguracja liczby p³ywaj¹cych elementów
\setcounter{topnumber}{0}%2
\setcounter{bottomnumber}{3}%1
\setcounter{totalnumber}{5}%3
\renewcommand{\textfraction}{0.01}%0.2
\renewcommand{\topfraction}{0.95}%0.7
\renewcommand{\bottomfraction}{0.95}%0.3
\renewcommand{\floatpagefraction}{0.35}%0.5
\renewcommand\thesection{\arabic{section}}

\begin{document}
\frenchspacing
\pagestyle{uheadings}

%strona tytu³owa
\title{\bf Sprawozdanie z projektu i æwiczenia laboratoryjnego nr 4, zadanie nr 1\vskip 0.1cm}
\author{Hubert Kozubek, Przemys³aw Michalczewski}
\date{2021}

\makeatletter
\renewcommand{\maketitle}{\begin{titlepage}
\begin{center}{\LARGE {\bf
Wydzia³ Elektroniki i Technik Informacyjnych}}\\
\vspace{0.4cm}
{\LARGE {\bf Politechnika Warszawska}}\\
\vspace{0.3cm}
\end{center}
\vspace{5cm}
\begin{center}
{\bf \LARGE Projektowanie uk³adów w sterowania\\ (projekt grupowy) \vskip 0.1cm}
\end{center}
\vspace{1cm}
\begin{center}
{\bf \LARGE \@title}
\end{center}
\vspace{2cm}
\begin{center}
{\bf \LARGE Zespó³ Z01
\vskip 0.1cm}
\end{center}
\begin{center}
{\bf \Large \@author \par}
\end{center}
\vspace*{\stretch{6}}
\begin{center}
\bf{\large{Warszawa, \@date\vskip 0.1cm}}
\end{center}
\end{titlepage}
}
\makeatother

\maketitle

\tableofcontents

\chapter{Laboratorium}
\section{Cel laboratorium}
Celem niniejszego laboratorium by³a implementacja, weryfikacja poprawnoœci dzia³ania i~dobór parametrów algorytmów regulacji 2-wymiarowego liniowego procesu laboratoryjnego dla stanowiska grzej¹co-ch³odz¹cego przedstawionego na rys. \ref{stanowisko_grzewcze}. Nale¿a³o równie¿ wykonaæ wizualizacjê procesu.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/Stanowisko-grzewcze.png }
	\caption {Stanowisko grzej¹co-ch³odz¹ce u¿ywane w trakcie laboratoriów.}
	\label{stanowisko_grzewcze}
\end{figure}


\section{Przebieg laboratorium}
Rozpoczynaj¹c pracê na stanowisku grzej¹co-ch³odz¹cym z wykorzystaniem PLC sprawdzono mo¿liwoœæ sterowania i~pomiaru w~komunikacji ze stanowiskiem. W~szczególnoœci sygna³y steruj¹ce wykorzystywane podczas niniejszego laboratorium W1, G1, G2 oraz pomiaru T1, T3 (elementy wykonawcze przedstawiono na rys. \ref{stanowisko_grzewcze_schemat}). Przez ca³y czas trwania laboratorium moc wentylatora W1 by³a ustawiona na 50\%, a wentylator by³ traktowany jako cecha otoczenia. Dodatkowo sprawia³ on, ¿e temperatura grza³ki
opada³a szybciej, co by³o szczególnie przydatne pomiêdzy doœwiadczeniami.


\begin{figure}[!ht]
		\centering
		\includegraphics[width=0.7\textwidth]{ ./Rysunki/Stanowisko-grzewcze-schemat.png }
		\caption {Schemat stanowiska grzej¹co-ch³odz¹cego; zaznaczone elementy wykonawcze: wentylatory W1, W2, W3, W4, grza³ki G1, G2, czujniki temperatury T1, T2, T3, T4, T5 (temperatura
otoczenia), pomiar pr¹du P1, pomiar napiêcia P2.}
		\label{stanowisko_grzewcze_schemat}
\end{figure}

\section{Punkt pracy stanowiska}
W celu wyznaczenia punktu pracy stanowiska dla mocy grza³ek G1=26\%, G2=31\% zadano te wartoœci dla sygna³u steruj¹cego grza³kami za pomoc¹ programu sterownika. Nastêpnie poczekano, a¿ temperatury T1, T3 ustal¹ siê. Wynik eksperymentu przedstawiono na rys. \ref{punkt_pracy}. Odczytana wartoœæ temperatur to T1=33,25  $^{\circ}$C oraz T3=34,68 $^{\circ}$C. Wyniki eksperymentu przedstawiono na rys. \ref{punkt_pracy}.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/punkt_pracy.pdf }
	\caption{Wyznaczenie punktu pracy.}
	\label{punkt_pracy}
\end{figure}


\section{Odpowiedzi skokowe}

W celu uzyskania odpowiedzi skokowej w konfguracjach ka¿de wejœcie, ka¿de wyjœcie dla 2-wymiarowego procesu zmieniono skokowo wartoœæ sterowania najpierw grza³ki G1 i pobrano odpowiedŸ skokow¹ dla obu wyjœæ (T1, T3). Nastêpnie analogicznie post¹piono dla skoku sterowania grza³ki G2. Wyniki uzyskane w ten sposób przedstawiono na rys.: \ref{odp_skok1}, \ref{odp_skok2}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/odp_skok1.pdf }
	\caption{OdpowiedŸ skokowa dla zmiany sterowania grza³ki G1}
	\label{odp_skok1}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/odp_skok2.pdf}
	\caption{OdpowiedŸ skokowa dla zmiany sterowania grza³ki G2}
	\label{odp_skok2}
\end{figure}

\section{Iterfej operatora}
Do wizualizacji procesu stworzono interfejs operatora w programie GT Designer3. Wynik pracy przedstawiono na rys.\ref{hmi}. Przedstawia on graficznie wartoœci zadane i wyjœciowe (po lewej stronie ekranu jako wykresy s³upkowe, czerwne puste s³upoki to wartoœci zadane, wype³nione to wartoœci wyjœciowe dla procesu). Na górze wyœwietlacza w postaci wykresu s³upkowego pozionego przedstawiono moce grza³ek. W centralnej czêœci ekranu wypisano wartoœci dok³adne poszczególnych sygna³ów.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/HMI.png }
	\caption {Interfejs operatora dla stanowiska grzej¹co-ch³odz¹cego (GT Designer3)}
	\label{hmi}
\end{figure}


\section{Kod sterownika}

Pierwsza czêœæ przedstawia zabezpieszenie przed nadmiernym przegrzaniem stanowiska, w momencie gdy temperatury T1 lub T3 przekrocz¹ ustalony limit grza³ki zostaj¹ wy³¹czone. Kod jest umijscowiony na koñcu programu, tak aby inne ustawione wartoœci sterowañ nie wp³ywa³y na waroœæ wyznaczon¹ przez zabezpieczenie.

\begin{lstlisting}
//Zabezpieczenie przed przegrzaniem
IF temp1>=25000 THEN
	grzalka1 := 0;
END_IF;

IF temp3>=25000 THEN
	grzalka2 := 0;
END_IF;
\end{lstlisting}

Fragment kodu przedstawia automat stanów, który zmienia poszczególne wartoœci zadane w momencie, gdy regulator osi¹gnie odpowiedni¹ wartoœæ w danym stanie.

\begin{lstlisting}
CASE  Stan  OF
	0:
	T1_zad := 3500;
	T3_zad := 4500;
	IF temp1 + eps >=T1_zad AND temp1-eps <=T1_zad AND temp3 
		...  + eps >= T3_zad AND temp3 - eps <= T3_zad THEN
		Stan := 1;
	END_IF;
	1:
	T1_zad := 5500;
	T3_zad := 4100;
	IF temp1 + eps >=T1_zad AND temp1-eps <=T1_zad AND temp3 
		...+ eps >= T3_zad AND temp3 - eps <= T3_zad THEN
		Stan := 2;
	END_IF;
	2:
	T1_zad := 3000;
	T3_zad := 2700;
	IF temp1 + eps >=T1_zad AND temp1-eps <=T1_zad AND temp3
		... + eps >= T3_zad AND temp3 - eps <= T3_zad THEN
		Stan := 0;
	END_IF;
		
	END_CASE;
\end{lstlisting}

\chapter{Projekt}
\section{Informacje wstêpne}
Zadanie projektowe wykorzystywa³o symulowany obiekt regulacji. Wyjœcie obiektu mo¿na wyznaczyæ przy pomocy polecenia: 

\begin{lstlisting}
[y1(k),y2(k),y3(k)] = symulacja_obiektu1_p4(u1(k-1),u1(k-2),...
			u1(k-3),u1(k-4),u2(k-1),u2(k-2),...
			u2(k-3),u2(k-4),u3(k-1),u3(k-2),...
			u3(k-3),u3(k-4),u4(k-1),u4(k-2),...
			u4(k-3),u4(k-4),y1(k-1),y1(k-2),...
			y1(k-3),y1(k-4),y2(k-1),y2(k-2),...
			y2(k-3),y2(k-4),y3(k-1),y3(k-2),...
			y3(k-3),y3(k-4));
											
\end{lstlisting}

\section{Sprawdzenie poprawnoœci punktu pracy}
Wartoœci sygna³ów wejœcia i wyjœcia procesu w punkcie pracy wynosz¹ u1 = u2 = u3 = u4 = y1 = y2 = y3 = 0; okres
próbkowania wynosi 0,5 sekundy.

W celu sprawdzenia poprawnoœci punktu pracy zosta³a przeprowadzona symulacja, gdzie na
wejœcie podano sterowanie u1 = u2 = u3 = u4 = 0, jako poprzednie wartoœci wyjœcia podano y1 = y2 = y3 = 0 i sprawdzono
wartoœæ wyjœcia procesu w nastêpnych chwilach. Wyniki symulacji przedstawiono na rys. \ref{p1}
Wartoœæ sygna³u wyjœciowego pozosta³a bez zmian, co potwierdza poprawnoœæ podanego punktu
pracy.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P1_Punkt_Pracy.pdf }
	\caption {Punkt pracy}
	\label{p1}
\end{figure}

\section{Odpowiedzi skokowe procesu}
Wyznaczone zosta³y odpowiedzi skokowe dla ka¿dej pary wejœcia i wyjœcie. Odpowiedzi skokowe przedstawiono na rys. \ref{p2}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P2_Odpowiedzi_Skokowe.pdf }
	\caption {Odpowiedzi skokowe}
	\label{p2}
\end{figure}

\section{Regulatory cyfrowe PID i  ich strojenie}

Implementacja algorytmu PID dla obiektu wielowymiarowego:

\begin{lstlisting}
function[u1,u2,u3,u4] = PID_Multi_Dim(K,Ti,Td,yzad1,yzad2,yzad3,y1,y2,y3)

%% Uchyby
persistent e10;
persistent e11;
persistent e20;
persistent e21;
persistent e30;
persistent e31;
persistent upop1;
% persistent upop2;
persistent upop3;
persistent upop4;

if isempty(e10)
    e10 = 0;
    e11 = 0;
    e20 = 0;
    e21 = 0;
    e30 = 0;
    e31 = 0;
    upop1 = 0;
    upop3 = 0;
    upop4 = 0;
end


e12 = e11;
e11 = e10;
e10 = yzad1 - y1;
e22 = e21;
e21 = e20;
e20 = yzad2 - y2;
e32 = e31;
e31 = e30;
e30 = yzad3 - y3;

%% Parametry
T = 0.5;
K1 = K(1); %Kk1 = 2.6, Tk = 5.625 
K2 = K(2); %Kk1 = 7.1, Tk = 5.7
K3 = K(3); %Kk1 = 7.9, Tk = 5.6
Ti1 = Ti(1);
Ti2 = Ti(2);
Ti3 = Ti(3);
Td1 = Td(1);
Td2 = Td(2);
Td3 = Td(3);

r10 = K1*(1 + T/(2*Ti1) + Td1/T);
r11 = K1*(T/(2*Ti1) - 2*Td1/T - 1);
r12 = K1*Td1/T;

r20 = K2*(1 + T/(2*Ti2) + Td2/T);
r21 = K2*(T/(2*Ti2) - 2*Td2/T - 1);
r22 = K2*Td2/T;

r30 = K3*(1 + T/(2*Ti3) + Td3/T);
r31 = K3*(T/(2*Ti3) - 2*Td3/T - 1);
r32 = K3*Td3/T;

%% Wyliczanie sterowania


u1 = r12*e12 + r11*e11 + r10*e10 + upop1;
u2 = 0;
u3 = r22*e22 + r21*e21 + r20*e20 + upop3;
u4 = r32*e32 + r31*e31 + r30*e30 + upop4;

upop1 = u1;
upop3 = u3;
upop4 = u4;

end
\end{lstlisting}

Badaj¹c odpowiedzi skokowe torów wejœcie-wyjœcie zdecydowano siê zaimplementowaæ regulatory PID na torach u1-y1, u3-y2 i u4-y3.
Nastêpnie strojono je metod¹ Zieglera-Nicholsa. Strojenie i wyznaczenie wzmocnienia krytyznego przedstawiono na rys.: \ref{p3}, \ref{p4}, \ref{p5}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P3_1_Strojenie_PID1.pdf }
	\caption {PID wielowymiarowy, K = 2,6}
	\label{p3}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P3_2_Strojenie_PID2.pdf }
	\caption {PID wielowymiarowy, K = 7,1}
	\label{p4}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P3_3_Strojenie_PID3.pdf }
	\caption {PID wielowymiarowy, K = 7,9}
	\label{p5}
\end{figure}

\section{Wielowymiarowy regulator DMC}
Implementacja algorytmu regulacji DMC dla obiektu wielowymiarowego:

\begin{lstlisting}
function[u1,u2,u3,u4] = DMC_Multi_Dim(D,N,Nu,Psi,...
			Lambda,yzad1,yzad2,yzad3,y1,y2,y3)
%% Uchyby
persistent Mp;
persistent S;
persistent DUp;
persistent M;
persistent K;
persistent upop1;
persistent upop2;
persistent upop3;
persistent upop4;
persistent Upop;
Yzad = repmat([yzad1; yzad2; yzad3], N,1);
Y = repmat([y1; y2; y3], N,1);

if isempty(S)
    upop1 = 0;
    upop2 = 0;
    upop3 = 0;
    upop4 = 0;
    Upop = [0;0;0;0];
    load('Odpowiedzi_skokowe.mat');
    S = cell(D+N-1,1);
    for j = 1:D+N-1
        if(j>D)
            S{j} = [S11(D) S21(D) S31(D); S12(D) S22(D) S32(D);...
		S13(D) S23(D) S33(D); S14(D) S24(D) S34(D)];
        else
            S{j} = [S11(j) S21(j) S31(j); S12(j) S22(j) S32(j);...
		S13(j) S23(j) S33(j); S14(j) S24(j) S34(j)];
        end
        
    end
    Mp = zeros(3*N, 4*(D-1));
    for j = 1:D-1
        a = [S{j+1:N+j}]';
        b = repmat(S{j}',N,1);
        Mp(:,(4*j-3):(4*j)) = a - b;
    end
    DUp = zeros(4*(D-1),1);
    M = zeros(3*N, 4*Nu);
    for j = 1:Nu
       M((3*j - 2):end,(4*j-3):(4*j)) = [S{1:(N+1-j)}]';
    end
    K = pinv(M'*Psi*M+Lambda)*M'*Psi;
end

    DUp(5:end) = DUp(1:(end-4));
    DUp(1:4) = [upop1; upop2; upop3; upop4] - Upop;
    
    Yo = Y + Mp*DUp;
    Du = K*(Yzad - Yo);
    u1 = Du(1) + upop1;
    u2 = Du(2) + upop2;
    u3 = Du(3) + upop3;
    u4 = Du(4) + upop4;
    Upop = [upop1; upop2; upop3; upop4];
    upop1 = u1;
    upop2 = u2;
    upop3 = u3;
    upop4 = u4;

end
\end{lstlisting}
Nastêpnie zosta³ zaimplementowany wielowymiarowy regulator DMC. Jego wyniki przedstawiono na rys.: \ref{p6}, \ref{p7}, \ref{p8}, \ref{p9}. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P4_1_Strojenie_DMC.pdf }
	\caption {Regulacja DMC}
	\label{p6}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P4_2_Strojenie_DMC.pdf }
	\caption {Regulacja DMC}
	\label{p7}
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P4_3_Strojenie_DMC.pdf }
	\caption {Regulacja DMC}
	\label{p8}
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/P4_4_Strojenie_DMC.pdf }
	\caption {Regulacja DMC}
	\label{p9}
\end{figure}


 


\end{document}

