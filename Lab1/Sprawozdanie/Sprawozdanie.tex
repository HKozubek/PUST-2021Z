\documentclass[a4paper,titlepage,11pt,twosides,floatssmall]{mwrep}
\usepackage[left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage[OT1]{fontenc}
\usepackage{polski}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
\usepackage{url}
\usepackage{tikz}
\usetikzlibrary{arrows,calc,decorations.markings,math,arrows.meta}
\usepackage{rotating}
\usepackage[percent]{overpic}
\usepackage[cp1250]{inputenc}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{pgfplots}
\usetikzlibrary{pgfplots.groupplots}
\usepackage{listings}
\usepackage{matlab-prettifier}
\usepackage{enumitem,amssymb}
\definecolor{szary}{rgb}{0.95,0.95,0.95}
\definecolor{niebieski}{rgb}{0,0.447,0.741}
\definecolor{czerwony}{rgb}{0.85,0.325,0.098}

\usepackage{siunitx}
%\usepackage{gensymb}
\sisetup{detect-weight,exponent-product=\cdot,output-decimal-marker={,},per-mode=symbol,binary-units=true,range-phrase={-},range-units=single}
\SendSettingsToPgf
%konfiguracje pakietu listings
\lstset{
	backgroundcolor=\color{szary},
	frame=single,
	breaklines=true,
}
\lstdefinestyle{customlatex}{
	basicstyle=\footnotesize\ttfamily,
	%basicstyle=\small\ttfamily,
}
\lstdefinestyle{customc}{
	breaklines=true,
	frame=tb,
	language=C,
	xleftmargin=0pt,
	showstringspaces=false,
	basicstyle=\small\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{blue},
	stringstyle=\color{orange},
}
\lstdefinestyle{custommatlab}{
	captionpos=t,
	breaklines=true,
	frame=tb,
	xleftmargin=0pt,
	language=matlab,
	showstringspaces=false,
	basicstyle=\footnotesize\ttfamily,
	%basicstyle=\scriptsize\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{blue},
	stringstyle=\color{orange},
}

%wymiar tekstu (bez ˜ywej paginy)
\textwidth 160mm \textheight 247mm

%ustawienia pakietu pgfplots
\pgfplotsset{
tick label style={font=\scriptsize},
label style={font=\small},
legend style={font=\small},
title style={font=\small}
}

\def\figurename{Rys.}
\def\tablename{Tab.}

%konfiguracja liczby p˜ywaj˜cych element˜w
\setcounter{topnumber}{0}%2
\setcounter{bottomnumber}{3}%1
\setcounter{totalnumber}{5}%3
\renewcommand{\textfraction}{0.01}%0.2
\renewcommand{\topfraction}{0.95}%0.7
\renewcommand{\bottomfraction}{0.95}%0.3
\renewcommand{\floatpagefraction}{0.35}%0.5
\renewcommand\thesection{\arabic{section}}

\begin{document}
\frenchspacing
\pagestyle{uheadings}

%strona tytu˜owa
\title{\bf Sprawozdanie z projektu i æwiczenia laboratoryjnego nr 1, zadanie nr 1\vskip 0.1cm}
\author{Hubert Kozubek, Przemys³aw Michalczewski}
\date{2021}

\makeatletter
\renewcommand{\maketitle}{\begin{titlepage}
\begin{center}{\LARGE {\bf
Wydzia³ Elektroniki i Technik Informacyjnych}}\\
\vspace{0.4cm}
{\LARGE {\bf Politechnika Warszawska}}\\
\vspace{0.3cm}
\end{center}
\vspace{5cm}
\begin{center}
{\bf \LARGE Projektowanie uk³adów w sterowania\\ (projekt grupowy) \vskip 0.1cm}
\end{center}
\vspace{1cm}
\begin{center}
{\bf \LARGE \@title}
\end{center}
\vspace{2cm}
\begin{center}
{\bf \Large \@author \par}
\end{center}
\vspace*{\stretch{6}}
\begin{center}
\bf{\large{Warszawa, \@date\vskip 0.1cm}}
\end{center}
\end{titlepage}
}
\makeatother

\maketitle

\tableofcontents

\section{Cele projektu i laboratoriów}
Celem niniejszego laboratorium oraz projektu by³o zaprojektowanie, implementacja,
weryfikacja poprawnoœci dzia³ania oraz dobór parametrów algorytmów regulacji jednowymiarowego
procesu na grzewczym stanowisku laboratoryjnym przedstawionym na rys \ref{Stanowisko grzewcze}.


\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/Stanowisko-grzewcze.png }
	\caption {Stanowisko grzej¹co-ch³odz¹ce, u¿ywane w trakcie laboratoriów}
	\label{Stanowisko grzewcze}
\end{figure}

\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\textwidth]{ ./Rysunki/Stanowisko-grzewcze-schemat.png }
		\caption {Schemat stanowiska grzej¹co-ch³odz¹cego}
		\label{Stanowisko grzewcze, schemat}
\end{figure}

\section{Przebieg laboratorium}
Rozpoczynaj¹c pracê na stanowisku laboratoryjnym nale¿a³o ustawiæ moc wentylatora W1
na 50\%. Wentylator ten by³ traktowany jako cecha otoczenia. Dodatkowo sprawia³ on, ¿e temperatura grza³ki
opada³a szybciej, co by³o szczególnie przydatne pomiêdzy doœwiadczeniami.

W ramach laboratorium nale¿a³o wykonaæ 5 zadañ.

\begin{enumerate}
	\label{Lista-zadan}
  \item Odczytaæ wartoœc pomiaru termometru T1 dla mocy 26 grza³ki G1\%.
  \item Wyznaczyæ odpowiedŸ skokow¹ procesu dla 3 ró¿ych wartoœci G1\%.
  \item Wybraæ jedn¹ z dopowiedŸi skokowych, przekszta³ciæ j¹ i wykorzystaæ w algorytmie DMC. 
  \item Zaimplementowaæ algorytm PID i DMC, od regulacji procesu stanowiska, w jêzyku MATLAB.
  \item Dobraæ nastawy algorytmu PID oraz parametry algorytmu DMC metod¹ eksperymentaln¹.
\end{enumerate}

\section{Punkt pracy stanowiska}
W pierwszej kolejnoœci nale¿a³o sprawdziæ mo¿liwoœæ sterowania i pomiaru w komunikacji ze stanowiskiem.
Nastêpnie  odczytaæ wartoœæ temperatury termometru T1 w wyznaczonym punkcie pracy G1=26\%.
Po ustawieniu mocy grza³ki i odczekaniu, a¿ temperatura T1 ustabilizuje siê,
odczytana wartoœæ termometru T1 wynosi³a \num{31.12} °C. Wykres temperatury na termometrze T1 zosta³ przedstawiony na rys. \ref{PunktPracy}

\begin{figure}[H]
	\centering
	\input{../TikZ_rysunki/PunktPracy.tex}
	\caption{Ustalanie siê temperatury dla punktu pracy}
	\label{PunktPracy}
\end{figure}


\section{Odpowiedzi skokowe procesu}
W tej czœci laboratorium nale¿a³o przeprowadziæ eksperyment dla 3 rónych wartoœci mocy grza³ki G1.
Rozpoczynaj¹c eksperyment z punktu pracy G1=26\%, wyznaczono odpowiedzi skokowe procesu. Eksperyment by³ wykokany
dla trzech ró¿nych zmian sygna³u steruj¹cego, G1=36\%, G1=46\% oraz G1=56\%.
Wykresy przedstawiaj¹ce zmiany temperatury przedstawiono na rys. \ref{skoki}


% \begin{figure}
% \centering
% \input{../TikZ_rysunki/Skok1.tex}
% \caption{OdpowiedŸ skokowa procesu dla zmiany sterowania G1 z 26 do 36}
% \label{Skok1}
% \end{figure}

% \begin{figure}
% \centering
% \input{../TikZ_rysunki/Skok2.tex}
% \caption{OdpowiedŸ skokowa procesu dla zmiany sterowania G1 z 26 do 46}
% \label{Skok2}
% \end{figure}

\begin{figure}[H]
\centering
\input{../TikZ_rysunki/skoki.tex}
\caption{OdpowiedŸ skokowa procesu}
\label{skoki}
\end{figure}


\section{OdpowiedŸ skokowa w algorytmie DMC}
Wykonanie tego zadania polega³o na przekszta³ceniu jedn¹ z odpowiedzi
skokowych, tak aby otrzymaæ odpowiedŸ skokow¹ u¿ywan¹ w algorymie DMC.
W tym celu wybrano drug¹ odpowiedŸ skokow¹, tj. skok G1 z mocy 26\% do mocy 46\%.
Do przekszta³cenia zebranej odpowiedzi skokowej, na tak¹ nadaj¹c¹ siê do algorytmu DMC wykorzystano program TODO:"SkokDMC.m".
Program ten wylicza potrzebn¹ odpowiedŸ skokow¹ przy u¿yciu prostego wzoru.
\begin{equation}
	S(i)= \frac{Y(i) - Y_{\mathrm{pp}}}{U_{\mathrm{skok}} - U_{\mathrm{pp}}}
\end{equation}
gdzie:
\begin{itemize}
  \item $S(i)$ - odpowiedŸ skokowa potrzebna do algorytmu DMC,
	\item $Y(i)$ - odpowiedŸ skokowa przed przekszta³ceniem,
	\item $Y_{\mathrm{pp}}$ - wartoœæ wyjœcia w chwili k=0 (tutaj $Y_{\mathrm{pp}}$  = \num{31.12} ),
	\item $U_{\mathrm{skok}}$ - wartoœæ sterowanie w chwili k=0 i póŸniej (tutaj $U_{\mathrm{skok}} = 46$),
	\item $U_{\mathrm{pp}}$ - wartoœc sterowania przed chwil¹ k=0 (tutaj $U_{\mathrm{pp}} = 26$)
\end{itemize}
W ten sposób przekszta³cona odpowiedŸ skokowa zosta³a zapisana do pliku TODO: "dane1.mat"
i wykorzystana w dalszych czêœciach laboratorów.

Poza przekszta³ceniem odpowiedzi skokowej nale¿a³o j¹ jeszcze przybli¿yæ u¿ywaj¹c w tym celu cz³onu inercyjnego
drugiego rzêdu z opóŸnieniem.

\begin{equation}
	G(s)= \frac{K}{(sT_1 + 1)(sT_2 + 1)}e^{-T_{\mathrm{d}}s}
\end{equation}
Po dyskretyzacji danej transmitancji otrzymujemy

\begin{equation}
	G(z)= \frac{b_1z^{-1} + b_2z^{-2}}{1 + a_1z^{-1} + a_2z^{-2}}z^{-T_{\mathrm{d}}}
\end{equation}

gdzie
\begin{equation}
\begin{split}
	& a_1 = -\alpha_1 - \alpha_2 \\
	& a_2 = \alpha_1\alpha_2 \\
	& \alpha_1 = e^{-\frac{1}{T_1}} \\
	& \alpha_2 = e^{-\frac{1}{T_2}} \\
	& b_1 = \frac{K}{T_1 - T_2}[T_1(1-\alpha_1) - T_2(1-\alpha_2)] \\
	& b_2 = \frac{K}{T_1 - T_2}[\alpha_1T_2(1-\alpha_2) - \alpha_2T_1(1-\alpha_1)]
\end{split}
\end{equation}

Z wykresu odpowiedzi skokowej procesu zosta³o odczytane opóŸnienie. W naszym przypadku $T_{\mathrm{d}} = 9$.
Aby wyznaczyæ wartoœci pozosta³ych wspó³czynników u¿yto dostêpnej w matlabie funkcji ga, która minimalizuje
wartoœæ zadanej funkcji z wykorzystaniem algorytmu generycznego. Funkcja minimalizowana, to funkcja wyliczaj¹ca sumê kwadratów b³êdów
pomiêdzy odpowiedzi¹ skokow¹, a transmitancj¹ przybli¿aj¹c¹.

\lstinputlisting{../Programy/AproksSkokDMC.m}

Nastêpnie u¿ywaj¹c skryptu TODO:"Optymalizacja.m" zosta³y wyznaczone pozosta³e parametry transmitancji przybli¿aj¹cej odpowiedŸ skokow¹.
Ostateczne wartoœci parametrów to

\begin{equation}
	\begin{split}
		& K = 0.330938\\
		& T_1 = 0.000907 \\
		& T_2 = 82.104622 \\
		& T_{\mathrm{d}} = 9 \\
	\end{split}
\end{equation}

\begin{figure}[H]
	\centering
	\input{../TikZ_rysunki/aproksymacja.tex}
	\caption{OdpowiedŸ skokowa procesu, oraz transmitancja j¹ aproksumuj¹ca}
	\label{aproksymacja-odpowiedzi-skokowej}
\end{figure}

Wykres zarówno odpowiedzi skokowej, jak i transmitancji j¹ przybli¿aj¹cej zosta³ zamieszczony na rys. \ref{aproksymacja-odpowiedzi-skokowej}

\section{Algorytm PID i DMC}
Kolejnym podpunktem zadañ laboratoryjnych by³o zaimplementowanie algorytmu regulacji PID oraz DMC w jêzyku MATLAB.

\subsection{Regulator PID}
\lstinputlisting{../Programy/PID.m}

\subsection{Regulator DMC}
\lstinputlisting{../Programy/DMC.m}

\section{Dostrajanie Regulatorów}

Ostatnim zadaniem by³ dobór nastawów obu algorytmów regulacji. W tym celu sko¿ystano z wczœniej uzyskanej transmitancji aproksymuj¹cej skok procesu,
aby dobraæ parametry obu regulatorów. W ten sposób mo¿na by³o przeprowadziæ wiêcej eksperymentów w krótszym czasie.
Uzyskane w ten sposób parametry zosta³y przetestowane na realnym procesie.

\subsection{Strojenie PID}

Do strojenia regulatora PID zosta³¹ wykorzystana metoda Zieglera-Nicholsa. Parametry do niej potrzebne wyznaczono na procesie symulowanym.
Oscylacje niegasn¹ce otrzymano dla parametrów $K_\mathrm{k} = 43$ oraz $T_\mathrm{k} = 36$.
Na tej podstawie dobrano nastêpuj¹ce parametry regulatora PID $K = \num{21.5}; T_\mathrm{i} = 18; T_\mathrm{d} =\num{4.5}$.
Oczywiœcie do regulacji zosta³y wykorzystane parametry PID-a dyskretnego okreœlone wzorami ($T_\mathrm{p} = 1$)

\begin{equation}
	\begin{split}
		& r_2 = K\frac{T_\mathrm{d}}{T_\mathrm{p}} \\
		& r_1 = K(\frac{T_\mathrm{p}}{2T_\mathrm{i}} -2\frac{T_\mathrm{d}}{T_\mathrm{p}} - 1) \\
		& r_0 = K(1+\frac{T_\mathrm{p}}{2T_\mathrm{i}} + \frac{T_\mathrm{d}}{T_\mathrm{p}}) \\
	\end{split}
\end{equation}


\begin{figure}[H]
	\centering
	\input{../TikZ_rysunki/testPID1.tex}
	\caption{Regulacja PID, eksperyment 1}
	\label{PID1}
\end{figure}

% TODO:
% Opisaæ przebiegi doboru parametrów,
% podpisaæ parametry,
% policzyæ errory

Wyniki regulacji PID dla tych parametrów przedstawiono na rys. \ref{PID1}
W dalszej kolejnoœci sprawdzane by³y jescze inne wartoœci parametrów, w celu znalezienia jak najlepszych nastawów.

\begin{figure}[H]
	\centering
	\input{../TikZ_rysunki/testPID2.tex}
	\caption{Regulacja PID, eksperyment 2}
	\label{PID2}
\end{figure}

\begin{figure}[H]
	\centering
	\input{../TikZ_rysunki/testPID3.tex}
	\caption{Regulacja PID, eksperyment 3}
	\label{PID3}
\end{figure}

\begin{figure}[H]
	\centering
	\input{../TikZ_rysunki/testPID4.tex}
	\caption{Regulacja PID, eksperyment 4}
	\label{PID4}
\end{figure}


\begin{figure}[H]
	\centering
	\input{../TikZ_rysunki/testDMC.tex}
	\caption{Regulacja DMC, eksperyment 1}
	\label{DMC1}
\end{figure}

\section{Projekt}

Zadanie projektowe wykorzystywa³o symulowany obiekt regulacji.
Wyjœcie obiektu mo¿na wyznaczyæ przy pomocy polecenia

\text{Y(k)=symulacja obiektu1y p1(U(k-10),U(k-11),Y(k-1),Y(k-2))}

Wartoœci sygna³ów w wejœcia i wyjœcia procesu w punkcie pracy wynosz¹
$U_\mathrm{pp} = \num{0,5},  Y_\mathrm{pp} = 4$, natomiast ograniczenia sterowania wynosz¹
$U^\mathrm{min} = \num{0,3}, U^\mathrm{max} = \num{0,7}$, a okres próbkowania wynosi \num{0,5}.

\section{Sprawdzanie poprawnoœæ wartoœci $U_\mathrm{pp},  Y_\mathrm{pp}$}

W celu sprawdzenia poprawnoœci punktu pracy zosta³a przeprowadzona symulacja, gdzie na wejœcie podano
$U_\mathrm{pp}$, jako poprzednie wartoœci y podano $Y_\mathrm{pp}$  i sprawdzono wartoœæ wyjœcia procesu w nastêpnych chwilach. Wyniki symulacji przedstawstawiono na rys. \ref{Punkt-pracy}

\begin{figure}[H]
	\centering
	\input{../../Projekt1/rysunki_tikz/punkt_pracy.tex}
	\caption{Sprawdzanie poprawoœci punktu pracy}
	\label{Punkt-pracy}
\end{figure}


\section{Odpowiedzi skokowe procesu}

W tej czêœci wyznaczone zosta³y odpowiedzi skokowe procesu, dla kilku zmian sygna³u steruj¹cego,
gdzie wartoœæ pocz¹tkowa sterowania wynosi³a $U_\mathrm{pp}$. Wyniki symulacji przedstawia rys. \ref{Odpowiedzi-skokowe}

\begin{figure}[h]
	\centering
	\input{../../Projekt1/rysunki_tikz/odpowiedzi_skokowe.tex}
	\caption{Odpowiedzi skokowe procesu}
	\label{Odpowiedzi-skokowe}
\end{figure}

W celu ustalenia, czy proces jest liniowy, zosta³ narysowany wykres zale¿noœci Y(U), dla dozwolonych wartoœci sterowania.
Wykres ten zosta³ przedstawiony na rys. \ref{Charakterystyka-statyczna}. Z wykresu wynika, ¿e zale¿noœæ jest liniowa, zatem wzmocnienie statyczne mo¿na wyznaczyæ jako tg prostej.
W naszym przypadku $K_{\mathrm{stat}} = 2$

\begin{figure}[h]
	\centering
	\input{../../Projekt1/rysunki_tikz/charakterystyka_statyczna.tex}
	\caption{Charakterystyka statyczna, wyznaczanie wzmocnienia}
	\label{Charakterystyka-statyczna}
\end{figure}


\section{Przekszta³cenie odpowiedzi skokowej}

Do przekszta³cenia zosta³a wybrana odpowiedŸ skokowa dla sterowania $U_\mathrm{skok} = \num{0.65}$
W pierwszej kolejnoœci zebrane dane, zosta³y przesuniête w czasie, tak aby skok sterowania nastêpowa³ dla $k=0$.
Nastêpnie wartoœci skoku zosta³y przeskalowane i przesuniête w odpowiedni sposób, tak aby odpowiedŸ da³o siê wykorzystaæ w algorytmie DMC.
Wynikowa odpowiedŸ skokowa zosta³a przedstawiona na rys. \ref{Odpowiedz-skokowa-DMC}

\begin{figure}[h]
	\centering
	\input{../../Projekt1/rysunki_tikz/skok_DMC.tex}
	\caption{Przekszta³cona odpowiedŸ skokowa}
	\label{Odpowiedz-skokowa-DMC}
\end{figure}


\section{Implementacja PID i DMC}

\subsection{PID}
\lstinputlisting{../../Projekt1/programy_Matlab/PID_funkcja.m}

\subsection{DMC}
\lstinputlisting{../../Projekt1/programy_Matlab/DMC_funkcja.m}


\section{Dobór nastawów PID i DMC metod¹ eksperymentaln¹}

\subsection{Nastawy PID}
W celu doboru nastawów regulatora PID skorzystano z metody Zieglera-Nicholsa. Oscylacje niegasn¹ce otrzymano dla $K_\mathrm{kryt} = \num{1.115}$, z okresem
$T_\mathrm{kryt} = 37$. Wyliczaj¹c wartoœci parametrów jako $K = \num{0.6}K_\mathrm{kryt}, T\mathrm{i} = \num{0.5}T_\mathrm{kryt}, T\mathrm{d} = \num{0.12}T_kryt$,
a nastêpnie przeliczajac je na nastawy PID-u dyskretnego, rozpoczêta zosta³a regulacja, przedstawiona na rys. \ref{test-PID1}.

\begin{figure}[h]
	\centering
	\input{../../Projekt1/rysunki_tikz/test_PID1.tex}
	\caption{Regulator PID - test1, $K = \num{0.669}, T_\mathrm{i} = \num{18.5}, T_\mathrm{d} = \num{4.44}$ }
	\label{test-PID1}
\end{figure}

Modyfikuj¹c parametry regulatora przeprowadzone zosta³y jeszcze 3 eksperymenty przedstawione na rys. \ref{test-PID2}, rys. \ref{test-PID3} i rys. \ref{test-PID4}

\begin{figure}[h]
	\centering
	\input{../../Projekt1/rysunki_tikz/test_PID2.tex}
	\caption{Regulator PID - test2, $K = \num{0.75}, T_\mathrm{i} = \num{16}, T_\mathrm{d} = \num{3}$}
	\label{test-PID2}
\end{figure}

\begin{figure}[h]
	\centering
	\input{../../Projekt1/rysunki_tikz/test_PID3.tex}
	\caption{Regulator PID - test3, $K = \num{0.67}, T_\mathrm{i} = \num{10}, T_\mathrm{d} = \num{0.1}$}
	\label{test-PID3}
\end{figure}

\begin{figure}[h]
	\centering
	\input{../../Projekt1/rysunki_tikz/test_PID4.tex}
	\caption{Regulator PID - test4, , $K = \num{0.8}, T_\mathrm{i} = \num{7}, T_\mathrm{d} = \num{2}$}
	\label{test-PID4}
\end{figure}

Zmieniaj¹c wartoœci parametrów uda³o siê poprawiæ regulacjê, zarówno zmniejszy³a siê wartoœæ b³êdu, jak i wykresy wygl¹daj¹ lepiej.
Na tescie 3 i 4 PID dzia³a zdecydowanie szybciej, dodatkowo oscylacje w teœcie 4 s¹ zdecydowanie mniejsze.


\subsection{Nastawy DMC}


\end{document}
