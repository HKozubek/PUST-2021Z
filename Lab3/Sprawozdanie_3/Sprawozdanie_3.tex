\documentclass[a4paper,titlepage,11pt,twosides,floatssmall]{mwrep}
\usepackage[left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage[OT1]{fontenc}
% \usepackage[utf8]{inputenc}
\usepackage{polski}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
\usepackage{url}
\usepackage{tikz}
\usetikzlibrary{arrows,calc,decorations.markings,math,arrows.meta}
\usepackage{rotating}
\usepackage[percent]{overpic}
\usepackage[cp1250]{inputenc}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{pgfplots}
\usetikzlibrary{pgfplots.groupplots}
\usepackage{listings}
\usepackage{matlab-prettifier}
\usepackage{enumitem,amssymb}
\usepackage{verbatim}							%paczka do komentarza blokowego

\definecolor{szary}{rgb}{0.95,0.95,0.95}
\definecolor{niebieski}{rgb}{0,0.447,0.741}
\definecolor{czerwony}{rgb}{0.85,0.325,0.098}

\usepackage{siunitx}
\sisetup{detect-weight,exponent-product=\cdot,output-decimal-marker={,},per-mode=symbol,binary-units=true,range-phrase={-},range-units=single}
\SendSettingsToPgf

%konfiguracje pakietu listings
\lstset{
	backgroundcolor=\color{szary},
	frame=single,
	breaklines=true,
}
\lstdefinestyle{customlatex}{
	basicstyle=\footnotesize\ttfamily,
	%basicstyle=\small\ttfamily,
}
\lstdefinestyle{customc}{
	breaklines=true,
	frame=tb,
	language=C,
	xleftmargin=0pt,
	showstringspaces=false,
	basicstyle=\small\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{blue},
	stringstyle=\color{orange},
}
\lstdefinestyle{custommatlab}{
	captionpos=t,
	breaklines=true,
	frame=tb,
	xleftmargin=0pt,
	language=matlab,
	showstringspaces=false,
	basicstyle=\footnotesize\ttfamily,
	%basicstyle=\scriptsize\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{blue},
	stringstyle=\color{orange},
}

%wymiar tekstu (bez ¿ywej paginy)
\textwidth 160mm \textheight 247mm

%ustawienia pakietu pgfplots
\pgfplotsset{
tick label style={font=\scriptsize},
label style={font=\small},
legend style={font=\small},
title style={font=\small},
compat=newest										%chyba dobry dodatek, dla subplota xlabel nie nachodzi na inne wykresy
}

\def\figurename{Rys.}
\def\tablename{Tab.}

%konfiguracja liczby p³ywaj¹cych elementów
\setcounter{topnumber}{0}%2
\setcounter{bottomnumber}{3}%1
\setcounter{totalnumber}{5}%3
\renewcommand{\textfraction}{0.01}%0.2
\renewcommand{\topfraction}{0.95}%0.7
\renewcommand{\bottomfraction}{0.95}%0.3
\renewcommand{\floatpagefraction}{0.35}%0.5
\renewcommand\thesection{\arabic{section}}

\begin{document}
\frenchspacing
\pagestyle{uheadings}

%strona tytu³owa
\title{\bf Sprawozdanie z projektu i æwiczenia laboratoryjnego nr 3, zadanie nr 1\vskip 0.1cm}
\author{Hubert Kozubek, Przemys³aw Michalczewski}
\date{2021}

\makeatletter
\renewcommand{\maketitle}{\begin{titlepage}
\begin{center}{\LARGE {\bf
Wydzia³ Elektroniki i Technik Informacyjnych}}\\
\vspace{0.4cm}
{\LARGE {\bf Politechnika Warszawska}}\\
\vspace{0.3cm}
\end{center}
\vspace{5cm}
\begin{center}
{\bf \LARGE Projektowanie uk³adów w sterowania\\ (projekt grupowy) \vskip 0.1cm}
\end{center}
\vspace{1cm}
\begin{center}
{\bf \LARGE \@title}
\end{center}
\vspace{2cm}
\begin{center}
{\bf \LARGE Zespó³ Z01
\vskip 0.1cm}
\end{center}
\begin{center}
{\bf \Large \@author \par}
\end{center}
\vspace*{\stretch{6}}
\begin{center}
\bf{\large{Warszawa, \@date\vskip 0.1cm}}
\end{center}
\end{titlepage}
}
\makeatother

\maketitle

\tableofcontents

\chapter{Laboratorium}
\section{Cel laboratorium}
Celem niniejszego laboratorium by³a implementacja, weryfikacja poprawnoœci dzia³ania i~dobór parametrów algorytmów regulacji jednowymiarowego nieliniowego procesu laboratoryjnego dla stanowiska grzej¹co-ch³odz¹cego przedstawionego na rys. \ref{stanowisko_grzewcze}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{ ./Rysunki/Stanowisko-grzewcze.png }
	\caption {Stanowisko grzej¹co-ch³odz¹ce u¿ywane w trakcie laboratoriów.}
	\label{stanowisko_grzewcze}
\end{figure}


\section{Przebieg laboratorium}
Rozpoczynaj¹c pracê na stanowisku grzej¹co-ch³odz¹cym sprawdzono mo¿liwoœæ sterowania i~pomiaru w~komunikacji za stanowiskiem. W~szczególnoœci sygna³y steruj¹ce wykorzystywane podczas niniejszego laboratorium W1, G1, Z oraz pomiaru T1 (elementy wykonawcze przedstawiono na rys. \ref{stanowisko_grzewcze_schemat}). Przez ca³y czas trwania laboratorium moc wentylatora W1 by³a ustawiona na 50\%, a wentylator by³ traktowany jako cecha otoczenia. Dodatkowo sprawia³ on, ¿e temperatura grza³ki
opada³a szybciej, co by³o szczególnie przydatne pomiêdzy doœwiadczeniami.

W ramach laboratorium nale¿a³o wykonaæ 6 zadañ:
\begin{enumerate}
	\label{lista_zadan}
  \item Odczytaæ wartoœæ pomiaru temperatury dla termometru T1 dla mocy 26\% grza³ki G1 w~stanie ustalonym (wyznaczyæ punkt pracy).
  \item Przeprowadziæ eksperyment maj¹cy na celu okreœlenie wzmocnienie w funkcji sterowania: dla kolejnych wartoœci sterowania: 20, 30, $\hdots$ , 80 pozyskaæ wartoœæ ustabilizowanego sygna³u wyjœciowego i na ich podstawie narysowaæ punkty tworz¹ce charakterystykê statyczn¹
  \item Dla trajektorii zmian sygna³ów zadanych: $T_\mathrm{pp}$, $T_\mathrm{pp}$ + 5, $T_\mathrm{pp}$ + 15, $T_\mathrm{pp}$ przetestowaæ regulatory z laboratorium 1
  \item Zaimplementowaæ rozmyty algorytm PID i dla tej samej trajektorii zmian sygna³u wartoœci zadanej spróbowaæ dobraæ parametry lokalnych algorytmów PID w taki sposób, aby osi¹gn¹æ lepsz¹ jakoœæ regulacji w porównaniu z regulatorem pojedynczym
  \item Zaimplementowaæ rozmyty algorytm DMC w najprostszej
	wersji analitycznej, o parametrach $N_\mathrm{u}$ = $N$ = $D$ i $\lambda$ = 1 i dla powy¿szej trajektorii
	zmian sygna³u wartoœci zadanej wykonaæ eksperymenty dla 3 regulatorów lokalnych. 
	\item Dobraæ parametry okreœlaj¹ce karê za przyrosty sterowania lokalnych algorytmów DMC metod¹ eksperymentaln¹.
\end{enumerate}


\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\textwidth]{ ./Rysunki/Stanowisko-grzewcze-schemat.png }
		\caption {Schemat stanowiska grzej¹co-ch³odz¹cego; zaznaczone elementy wykonawcze: wentylatory W1, W2, W3, W4, grza³ki G1, G2, czujniki temperatury T1, T2, T3, T4, T5 (temperatura
otoczenia), pomiar pr¹du P1, pomiar napiêcia P2.}
		\label{stanowisko_grzewcze_schemat}
\end{figure}

% TODO:VV
\iffalse
\section{Punkt pracy stanowiska}
W celu wyznaczenia punktu pracy stanowiska dla mocy grza³ki G1=26\% zadano tê wartoœæ dla sygna³u steruj¹cego grza³k¹. Nastêpnie poczekano, a¿ temperatura T1 ustali siê. Wynik eksperymentu przedstawiono na rys. \ref{punkt_pracy}. Odczytana wartoœæ temperatury dla termometru T1 wynios³a \num{28.12} °C.



\section{Odpowiedzi skokowe toru zak³ócenie-wyjœcie}
Dla stanowiska pracuj¹cego w ustalonym punkcie pracy (G1=26\%; T1=\num{28.12}°C) zadano 3~ró¿ne wartoœci skoku zak³ócenia. Eksperyment wykonano dla skoków sygna³u zawsze z wartoœci Z=0 do kolejno wartoœci: Z=10, Z=20 oraz Z=30. Wyniki przedstawiono na rys. \ref{skok_zak}. Ró¿nica w pocz¹tkowych wartoœciach temperatury T1 dla poszczególnych skoków wynika z zak³óceñ powodowanch przez zmianê temperatury w pracowni laboratoryjnej oraz nagrzewania siê stanowiska grzej¹co-ch³odz¹cego.


Na podstawie wyznaczonej charakterystyki statycznej dla toru zak³ócenie-wyjœcie przedstawionej na rys. \ref{char_skok_zak} mo¿na stwierdziæ, ¿e w³aœciwoœci statyczne s¹ w~przybli¿eniu liniowe. Wzmocenienie statyczne dla tego toru procesu wyznaczono metod¹ najmniejszych kwadratów i otrzymano wartoœæ $K_{\mathrm{stat}}=0.1725$.



\section{Odpowiedzi skokowe dla algorytmu DMC}
W celu wyznaczenia odpowiedzi skokowej toru zak³ócenie-wyjœcie wybrano trzeci¹ odpowiedŸ skokow¹ przedstawion¹ na rys. \ref{skok_zak}, tj. skok zak³ócenia do wartoœci Z=30. Do przekszta³cenia zebranej odpowiedzi skokowej skorzystano z przekszta³cenia:

\begin{equation}
	S(i)= \frac{Y(i) - Y_{\mathrm{pp}}}{Z_{\mathrm{skok}} - Z_{\mathrm{pp}}}
\end{equation}
gdzie:
\begin{itemize}
  \item $S(i)$ - odpowiedŸ skokowa potrzebna do algorytmu DMC,
	\item $Y(i)$ - odpowiedŸ skokowa przed przekszta³ceniem,
	\item $Y_{\mathrm{pp}}$ - wartoœæ wyjœcia w chwili k=0 (tutaj $Y_{\mathrm{pp}}$  = \num{27.93}),
	\item $Z_{\mathrm{skok}}$ - wartoœæ sterowanie w chwili k=0 i póŸniej (tutaj $Z_{\mathrm{skok}} = 30$),
	\item $Z_{\mathrm{pp}}$ - wartoœæ sterowania przed chwil¹ k=0 (tutaj $Z_{\mathrm{pp}} = 0$)
\end{itemize}

Otrzymana odpowiedŸ skokowa dla toru zak³ócenie wyjœcie zosta³a przedsawiona na rys. \ref{skok_DMC_zak}. Nastêpnie dokonano aproksymacji odpowiedzi skokowej poprzez przybli¿enie u¿ywaj¹c w tym celu cz³onu inercyjnego drugiego stopnia z opóŸnieniem:

\begin{equation}
	G(s)= \frac{K}{(sT_1 + 1)(sT_2 + 1)}e^{-T_{\mathrm{d}}s}
\end{equation}

Po dyskretyzacji danej transmitancji otrzymujemy:
\begin{equation}
	G(z)= \frac{b_1z^{-1} + b_2z^{-2}}{1 + a_1z^{-1} + a_2z^{-2}}z^{-T_{\mathrm{d}}}
\end{equation}

gdzie:
\begin{equation}
\begin{split}
	& a_1 = -\alpha_1 - \alpha_2 \\
	& a_2 = \alpha_1\alpha_2 \\
	& \alpha_1 = e^{-\frac{1}{T_1}} \\
	& \alpha_2 = e^{-\frac{1}{T_2}} \\
	& b_1 = \frac{K}{T_1 - T_2}[T_1(1-\alpha_1) - T_2(1-\alpha_2)] \\
	& b_2 = \frac{K}{T_1 - T_2}[\alpha_1T_2(1-\alpha_2) - \alpha_2T_1(1-\alpha_1)]
\end{split}
\end{equation}

Dla otrzymanej w~ten sposób transmitancji w~postaci dyskretnej napisano funkcjê , która przyjmowa³a parametry $T_{\mathrm{1}}$, $T_{\mathrm{2}}$ oraz $K$. Wartoœæ parametru \\$T_{\mathrm{d}}=12$ odczytano z odpowiedzi skokwej, poniewa¿ jest to opóŸnienie. Funkcja ta zwraca sumaryczny b³¹d kwadratowy pomiêdzy aproksymacj¹ otrzyman¹ dla zadanych parametrów a eksperymentalnie wyznaczon¹ odpowiedzi¹ skokow¹ dla toru zak³ócenie-wyjœcie. Implementacja funkcji:


Do wyznaczenia wspó³czynników transmitancji u¿yto funkcji \verb+ga+ dostêpnej w programie MATLAB, która wykorzystuje algorytm generyczny do wyznaczenia minimum funkcji. Dla naszej funkcji jest to równowa¿ne ze znalezieniem najlepiej dopasowanej aproksymacji odpowiedzi skokowej toru zak³ócenie-wyjœcie.
Paramerty zwi¹zane z algorytmem generycznym to kolejno:

\begin{equation}
	\begin{split}
		& StallGenLimit = 200 \\
		& PopulationSize = 400 \\
		& FunctionTolerance = $1e^{-8}$ \\
	\end{split}
\end{equation}

gdzie:

\begin{itemize}
	\item $StallGenLimit$ oznacza maksymaln¹ iloœæ iteracji algorytmu, dla których wartoœæ ró¿nicy miêdzy wartoœciami wyniku funkcji optymalizowanej jest mniejsza ni¿ $FunctionTolerance$.
	\item $PopulationSize$ oznacza iloœæ ziaren dla algorytmu generytecznego w ka¿dej iteracji.
	\item $FunctionTolerance$ oznacza wartoœæ wskaŸnika toleracji, który determinuje dla jakiej dok³adonoœci algorytm uznaje, ¿e otrzymany wynik jest ostateczy.
\end{itemize}

Wybrane wartoœci powy¿szych parametrów pozwalaj¹ na aproksymacjê z ma³ym b³êdem, co sprawdzono poprzez kilkukrotne wywo³anie algorytmu i dostrojenie eksperymentalne parametrów. Implementacja optymalizacji:


Poniewa¿ do  minimalizacji funkcji u¿yto algorytmu generycznego to wyniki podczas kolejnych odtworzeñ mog¹ siê ró¿nic. Jednak po wykonaniu testów, dla których b³¹d aproksymacji by³ bardzo zbli¿ony przyjêto wartoœci parametrów:

\begin{equation}
	\begin{split}
		& K = 0.1772938\\
		& T_1 = 88.311400 \\
		& T_2 = 0.010351 \\
		& T_{\mathrm{d}} = 12 \\
	\end{split}
\end{equation}

Otrzyman¹ aproksymowan¹ odpowiedŸ skokow¹ dla toru zak³ócenie-wyjœcie dla algorytmu regulacji DMC przedstawiono na rys. \ref{skok_DMC_zak_apro}. OdpowiedŸ skokowa toru wejœcie-wyjœcie dla algorytmu DMC zosta³a zaczerpniêta z laboratorium nr 1, przedstawiono j¹ na rys. \ref{skok_DMC}. Analogicznie jak dla odpowiedzi skokowej toru zak³ócenie-wyjœcie wykonano dla niej aproksymacje przedstawion¹ na rys. \ref{skok_DMC_apro}.




\section{Algorytm DMC z pomiarem zak³óceñ}
Do sterowania procesem zaimplementowano algorytm DMC z pomiarem zak³óceñ w jêzyku MATLAB.




\section{Dobór parametrów dla algorytmu DMC}
W celu doboru parametrów algorytmu DMC zadawano skokow¹ wartoœæ sygna³u temperatury zadanej z punktu pracy G1=26, T1=\num{28.12}°C do temperatury zadanej \num{35}°C. Eksperymenty dla wybranych parametrów przedstawiono na rys. \ref{dobor_param_DMC1} i \ref{dobor_param_DMC2}. Mo¿na zauwa¿yæ, ¿e parametry s¹ dobrane znacznie lepiej dla ekperymentu drugiego (rys. \ref{dobor_param_DMC2}). Iloœciowa jakoœæ regulacji jest znacz¹co lepsza, b³¹d jest prawie 2-krotnie mniejszy. Porównuj¹c jakoœciowo regulacjê zauwa¿alne jest znacznie mniejsze przesterowanie od wartoœci zadanej temperatury. W porównaniu do pierwszego eksperymentu dla drugiego praktycznie niezauwa¿alne s¹ oscylacjie sygna³u wyjœciowego. W dalszej czêœci laboratorium przyjêto w³aœnie te parametry algorytmu DMC: $D=300$, $N=50$, $N_{\mathrm{u}}=10$, $\lambda=1$. 



\section{Regulacja procesu bez pomiaru zak³ócenia}
Do regulacji przyjêto parametr $D_{\mathrm{z}}=500$, poniewa¿ dla tej iloœci iteracji ustala³a siê odpowiedŸ skokowa toru zak³ócenie-wyjœcie. Regulacjê z wykorzystaniem algorytmu DMC bez pomiaru zak³ócenia przedstawiono na rys. \ref{bez_kom_1}. Na wykresie wartoœci wyjœciowej procesu mo¿na zauwa¿yæ znacz¹ce odchylenia od wartoœci zadanej w momentach skoków zak³ócenia, tj. 300[s] oraz 700[s].



\section{Regulacja procesu z pomiarem zak³ócenia}

Regulacjê z wykorzystaniem algorytmu DMC z eksperymentalnie wyznaczon¹ odpowiedzi¹ skokow¹ toru zak³ócenie-wyjœcie z pomiarem zak³ócenia przedstawiono na rys. \ref{kom_s_eksp}. Mo¿na zauwa¿yæ znacz¹c¹ poprawê jakoœci regulacji wzglêdem regulacji bez pomiaru zak³ócenia. Widoczna jest poprawa wskaŸnika jakoœci regulacji oraz zauwa¿alnie mniejsze odchylenia od wartoœci zadanej podczas wystêpowania skoków zak³óceñ.



W celu eksperymentalnym wykonano regulacjê z wykorzystaniem algorytmu DMC z aproksymowan¹ odpowiedzi¹ skokow¹ toru zak³ócenie-wyjœcie z pomiarem zak³ócenia. Wyniki przedstawione s¹ na rys. \ref{kom_s_apro}. Jakoœæ regulacji jest porównywalna do otrzymanej z wykorzystaniem eksperyentalnie uzyskanej odpowiedzi skokowej toru zak³ócenie-wyjœcie. Zarówno jakoœciowa jak i iloœciowa analiza tych regulacji nie pozwala jednoznacznie stwierdziæ, który wybór odpowiedzi skokowej jest lepszy. Niewielkie ró¿nice w jakoœci regulacji mog¹ wynikaæ z innych niemierzonych zak³óceñ, takich jak przep³yw powietrza w pracowni laboratoryjnej.




\chapter{Projekt}
\section{Informacje wstêpne}

Zadanie projektowe wykorzystywa³o symulowany obiekt regulacji. Wyjœcie obiektu mo¿na wyznaczyæ przy pomocy polecenia:

$y(k)=symulacja\_obiektu1y\_p2(u(k-6),u(k-7),z(k-2),z(k-3),y(k-1),y(k-2))$

Wartoœci sygna³ów wejœcia, wyjœcia i zak³ócenia procesu w punkcie pracy wynosz¹ $u = y = z = 0$; okres próbkowania wynosi \num{0,5} sekundy.


\section{Sprawdzenie poprawnoœci punktu pracy}

W celu sprawdzenia poprawnoœci punktu pracy zosta³a przeprowadzona symulacja, gdzie na wejœcie podano sterowanie $u = 0$, jako poprzednie wartoœci wyjœcia podano $y = 0$, wartoœæ zak³ócenia podano $z = 0$ i sprawdzono wartoœæ wyjœcia procesu w nastêpnych chwilach. Wyniki symulacji przedstawstawiono na rys. \ref{punkt_pracy}. Wartoœæ sygna³u wyjœciowego pozosta³a bez zmian, co potwierdza poprawnoœæ podanego punktu pracy.



\section{Odpowiedzi skokowe toru wejœcie-wyjœcie}
Wyznaczone zosta³y odpowiedzi skokowe dla kilku skoków wartoœci sygna³u steruj¹cego, gdzie wartoœæ pocz¹tkowa sterowania wynosi³a u=0. Wyniki symulacji przedstawiono na rys. \ref{odp_skok_wej}.





\section{Odpowiedzi skokowe toru zak³ócenie-wyjœcie}
Wyznaczone zosta³y odpowiedzi skokowe dla kilku skoków zak³ócenia mierzonego, gdzie wartoœæ pocz¹tkowa zak³ócenia wynosi³a z=0. Wyniki symulacji przedstawiono na rys. \ref{odp_skok_zak}.



\section{Charakterystyki statyczne torów procesu}
Na podstawie odpowiedzi skokowych wyznaczono charakterystyki statyczne dla toru\\ wejœcie-wyjœcie (rys. \ref{char_stat_wej}) oraz toru zak³ócenie-wyjœcie (rys. \ref{char_stat_zak}) korzystaj¹c z ustalonych wartoœci wyjœcia dla zadawanych sygna³ów, odpowiednio wejœcia i zak³ócenia. Z wykresów widaæ, ¿e w³aœciwoœci procesu s¹ w przybli¿eniu liniowe. Metod¹ najmniejszych kwadratów wyznaczono wzmocnienia statyczne tych procesów. Dla toru wejœcie-wyjœcie otrzymano $K_{\mathrm{stat}}=2.2957}$, zaœ dla toru zak³ócenie-wyjœcie otrzymano $K_{\mathrm{stat}}=1.4973}$.







\section{Wyznaczenie odpowiedzi skokowych wykorzystywanych w algorytmie DMC}

W celu wyznaczenia odpowiedzi skokowej dla algorytmu DMC toru wejœcie-wyjœcie dla symulowanego procesu wykonano skok wartoœci sterowania od 0 do 1 w chwili k=0. OdpowiedŸ skokowa dla tego toru znajduje siê na rys. \ref{skok_DMC_ster}.

W celu wyznaczenia odpowiedzi skokowej dla algorytmu DMC toru zak³ócenie-wyjœcie dla symulowanego procesu wykonano skok wartoœci zak³ócenia od 0 do 1 w chwili k=0. OdpowiedŸ skokowa dla tego toru znajduje siê na rys. \ref{skok_DMC_zak}.



\section{Implementacja algorytmu regulacji DMC dla procesu symulowanego}

\begin{lstlisting}[style=customlatex,frame=single,]
% maierz S i Sz tworzone sa plikach skokDMCSterowanie.m i skokDMCZaklocenie.m
load S
load Sz

% Punkt pracy
Upp = 0;
Ypp = 0;
Zpp = 0;

% Czas symulacji
time = 400;

Yzad(time,1) = 0;
Yzad(1:50) = Ypp;
Yzad(51:time) = 1;

% Parametry
N = 20; Nu = 20; lambda = 0.1;     

U(1:time) = Upp;
Y(1:time) = Ypp;
Z(1:time) = Zpp; 

Noise(1:time) = wgn(1,time,0.01)*0.05;

e(1:time) = 0;

% ----------------------------ALGORYTM DMC--------------------------
% Obliczenia offline
S = [S; zeros(N,1)];
for i = D+1:D+N
    S(i) = S(D);
end
        
M = zeros(N, Nu);
for i = 1:Nu
    M(i:N,i)=S(1:N-i+1);
end
       
Mp = zeros(N, D-1);
for i = 1:(D-1)
    Mp(1:N,i) = S(i+1:N+i) - S(i);
end

Sz = [Sz; zeros(N,1)];
for i = Dz+1:Dz+N
    Sz(i) = Sz(Dz);
end

Mpz = zeros(N, Dz);
for i = 1:(Dz)
    Mpz(1:N,i) = Sz(i+1:N+i) - Sz(i);
end

I = eye(Nu);
K = ((M'*M + lambda*I)^(-1))*M';

% inicjalizacja
dUP = zeros(D-1,1);
dZP = zeros(Dz, 1);
Y0 = zeros(N,1);
dU = zeros(Nu,1);
Yzad_DMC = zeros(N,1);
Y_DMC = zeros(N,1);

u = U - Upp;
yzad = Yzad - Ypp;

y(1:time) = 0;
u(1:time) = 0;

% liczone online

for k = 8:time
    Y(k) =  symulacja_obiektu1y_p2(U(k-6),U(k-7),Z(k-2),Z(k-3),Y(k-1),Y(k-2));
    y(k) = Y(k) - Ypp;
    e(k) = (yzad(k) - y(k))^2;
    
    Yzad_DMC = yzad(k)*ones(N,1);
    Y_DMC = y(k)*ones(N,1);
    
    dZP(2:Dz) = dZP(1:Dz-1);
    dZP(1) = Z(k) - Z(k-1) + Noise(k);
    Y0 = Y_DMC + Mp*dUP + Mpz*dZP;
    dU = K*(Yzad_DMC - Y0);
    du = dU(1);
        
    for n=D-1:-1:2
      dUP(n,1) = dUP(n-1,1);
    end
    dUP(1) = du;
   
    u(k) = u(k-1) + du;
    
    U(k) = u(k) + Upp;
end

E = 0;
for k = 8:time
    E = E + e(k);
end
\end{lstlisting}

\section{Dobór parametrów algorytmu DMC}
Dobór parametrów dla regulatora DMC odbywa³ siê w nastêpuj¹cy sposób. W pierwszej kolejnoœci zosta³y wybrane du¿e wartoœci parametrów $N$ i $N_{\mathrm{u}}$, natomiast dla parametru $\lambda$ przyjêto standardowo wartoœæ 1. Nastêpnie parametry by³y najczêœciej zmniejszane, ale równie¿ modyfikowane wed³ug intuicji in¿ynierskiej. Patrz¹c na wyniki symulacji mo¿na by³o wybraæ najlepszy nastaw. Z przeprowadzonych eksperymentów wynika, ¿e dla parametrów: $N=20, N_{\mathrm{u}}=20, \lambda=0.1$ wyniki regulacji s¹ najlepsze. Dla mniejszych wartoœci horyzontu predykcji i sterowania wyniki znacz¹co siê pogarszaj¹, natomiast dla wiêkszych nie jest zauwa¿alna znacz¹ca zmiana. Wybrane eksperymenty zosta³y pokazane na rys. \ref{dobor_param6}, \ref{dobor_param5}, \ref{dobor_param4}, \ref{dobor_param3}, \ref{dobor_param2}, \ref{dobor_param1}.








\section{Porównanie regulacji DMC z pomiarem zak³ócenia oraz bez pomiaru}

Aby sprawdziæ poprawnoœæ kompensacji zak³óceñ zosta³ przeprowadzony eksperyment ze skokiem wartoœci zadanej, po której nastêpi³ skok wartoœci zak³ócenia (po uprzednim ustaleniu siê wartoœci zadanej). Eksperyment zosta³ przeprowadzony dla zwyk³ego DMC oraz dla DMC wraz z kompensacj¹ zak³óceñ. Z wykresów (\ref{pom_zak}, \ref{bez_pom_zak})  mo¿na ³atwo wyczytaæ, ¿e DMC z kompensacj¹ zak³óceñ radzi sobie lepiej dla takiego sygna³u zak³óceñ. Jest to g³ównie spowodowane szybkoœci¹ z jak¹ DMC reaguje na zmianê wartoœci zak³ócenia. Algorytm z kompensacj¹ reaguje w tej samej iteracji, w której nast¹pi³a zmiana zak³ócenia, przez co proces szybciej powraca do wartoœci zadanej. Z koleji algorytm DMC w najprostrzej wersji analitycznej musi poczekaæ, a¿ zak³ócenie to przepropaguje siê na wartoœæ wyjœciow¹ sygna³u, poniewa¿ dopiero wtedy jest w stanie "zauwa¿yæ" zmianê zak³ócenia i na ni¹ zareagowaæ. 







\section{Dzia³anie algorytmu DMC przy zak³óceniach sinusoidalnych}
Mo¿na zauwa¿yæ, ¿e stosowanie kompensacji zak³óceñ w przypadku zak³óceñ okresowych o du¿ej czêstotliwoœci pogarsza regulacjê w znacznym stopniu. Jest to spowodowane tym, ¿e regulator z kompensacj¹ nie potrafi reagowaæ wystarczaj¹co szybko, przez co regulator nadawa³ wy¿sze sterowanie, pomimo ¿e sygna³ zak³ócenia przesta³ ju¿ opadaæ i zaczyna³ siê podnosiæ. Dla zak³óceñ tego rodzaju, na obiektach z wiêksz¹ inercj¹ toru wejœcie-wyjœcie ni¿ zak³ócenie-wyjœcie, stosowanie regulatorów bez kompensacji zak³óceñ okazujê siê lepszym rozi¹zaniem. Uk³ad jest wtedy bardziej bezw³adny, dziêki czemu nie nastêpuje wzmocnienie zak³ócenia wywo³ane wyliczeniem sterowania z przed chwili. 



\section{Badanie odpornoœci algorytmu DMC na szum pomiarowy sygna³u zak³ócenia}
Eksperymenty przeprowadzone dla ró¿nych wartoœci b³êdu pomiaru zak³óceñ pokazuj¹ jasno, ¿e regulator jest odpory na szumy pomiarowe, o ile warotœci szumu s¹ w granicach rozs¹dku. Wartoœci szumów nie przekracza³y 10\% wartoœci $Y_{\mathrm{zad}}$, dziêki czemu wyjœcie procesu nie odbiega³o w znacz¹cym stopniu od wartoœci zadanej. Patrz¹c na eksperymenty nasuwa siê jeszcze dodatowy wniosek zwiazany z szybkoœci¹ zmian szumu. Na rys. \ref{szum3} widaæ, ¿e regulator nie jest w stanie nad¹¿yæ sterowaniem za sygna³em szumu, przez co mo¿na zauwa¿yæ, ¿ê wartoœæ b³êdu jest wy¿sza, ni¿ dla innych eksperymentów.


\fi

\end{document}

